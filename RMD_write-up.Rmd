---
title: "Mental Health Outcomes in Gamers"
author: "Team 5 -- DATS 6101"
# date: "today"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: show
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=F}
library(ezids)
library(readr)
library(ggplot2)
library(dplyr)
library(stringr)
library(rstatix)
library(knitr)
library(kableExtra)
library(reshape2)
```


```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(warning = F, results = "markup", message = F)
options(scientific=T, digits = 3) 
```

```{r read-in, include=TRUE}
df <- read_csv("GamingStudy_data.csv")
```

## Introduction

### Reasearch Question

ffnvjnvfijvnerijnvrejivnerijvnerijvnervijnerv
jnevirenviernvirenviernviernveriunveriuvneruivnrev
rejivnpreinvervnervnervneprovnerpouvn

### The Data

ijsvisdjnvijsdnvijsdnvskmosdmvosmdos

### Mental Health Inventories and Predictors 

GAD-7, SPIN, SWL...

Hours, Streams.....


## Exploratory Data Analysis 

### Respondent Demographics 

``` {r, countryplot}
Residence_counts <- as.data.frame(table(df$Residence))
colnames(Residence_counts) <- c("Residence", "SurveyCount")
Residence_counts <- Residence_counts[order(-Residence_counts$SurveyCount), ]

# Keep only the top 10 residences
top_10_residences <- head(Residence_counts, 20)

# Create the plot
fig <- ggplot(top_10_residences, aes(x = reorder(Residence, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  geom_text(aes(label = SurveyCount), vjust = -0.5, color = 'white') +
  labs(title = 'Top 20 Residence Distribution', 
       x = '', 
       y = 'Total Surveyors') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)
```

words about plot

``` {r, gameplot}
game_counts <- as.data.frame(table(df$Game))
colnames(game_counts) <- c("Game", "SurveyCount")
game_counts <- game_counts[order(-game_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(game_counts, aes(x = reorder(Game, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Game Distribution', 
       subtitle = '', 
       x = '', 
       y = 'Total Surveyors') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))
# Print the figure
print(fig)
```


``` {r, genderplot}
gender_counts <- as.data.frame(table(df$Gender))
colnames(gender_counts) <- c("Gender", "SurveyCount")
gender_counts <- gender_counts[order(-gender_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(gender_counts, aes(x = reorder(Gender, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Gender Distribution', 
       subtitle = '', 
       x = '', 
       y = 'Total Respondents') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)
```

words.....


``` {r, age}
age_counts <- as.data.frame(table(df$Age))
colnames(age_counts) <- c("Age", "SurveyCount")
age_counts <- age_counts[order(-age_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(age_counts, aes(x = reorder(Age, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Age Distribution', 
       subtitle = '', 
       x = 'Age', 
       y = 'Total Respondents') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)

```

words....

### Distribution of Inventories 

GAD 

```{r, gaddist}
ggplot(data = df, aes(x = GAD_T)) +
  geom_histogram(binwidth = 1,
                 color = "red",
                 fill = "blue",
                 alpha = .7) + # opacity
  labs(x = "GAD Total Score", y = "Frequency", title = "GAD Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```
words....


SWL 

```{r, swldist}
ggplot(data = df, aes(x = SWL_T)) +
  geom_histogram(binwidth = 1,
                 color = "pink",
                 fill = "green",
                 alpha = .7) + # opacity
  labs(x = "SWL Total Score", y = "Frequency", title = "SWL Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```


SPIN 

```{r, spindist}
ggplot(data = df, aes(x = SPIN_T)) +
  geom_histogram(binwidth = 1,
                 color = "orange",
                 fill = "purple",
                 alpha = .7) + # opacity
  labs(x = "SPIN Total Score", y = "Frequency", title = "SPIN Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

words....

Maybe there is a way to make all three plots side-by-side??


### Below is all the code for LOG and SCALE() Transforms...Anith, up to you if we show any of this

#### Applying log transform to GAD and SPIN to make them more normal

```{r, logtransgad}
# Log-transform the GAD_T column (adding 1 to avoid log(0))
df$log_GAD_T <- log(df$GAD_T + 1)

# Create the histogram with a KDE curve
ggplot(data = df, aes(x = log_GAD_T)) +
  geom_histogram(aes(y = ..density..),  # Use density for y-axis
                 binwidth = 0.5,
                 color = "red",
                 fill = "blue",
                 alpha = 0.7) +  # Opacity
  geom_density(color = "green",           # Color of the KDE curve
               size = 1,                  # Thickness of the curve
               adjust = 1) +              # Adjust bandwidth for fitting
  labs(x = "GAD Log Total Score", 
       y = "Density",                   # Change to Density for y-axis
       title = "GAD Log Distribution with KDE") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

qqnorm(df$log_GAD_T, main="Q-Q plot for Log GAD") 
qqline(df$log_GAD_T)
```



```{r, logtransswl}
# Log-transform the SPIN_T column (adding 1 to avoid log(0))
df$log_SPIN_T <- log(df$SPIN_T + 1)

# Create the histogram with a KDE curve
ggplot(data = df, aes(x = log_SPIN_T)) +
  geom_histogram(aes(y = ..density..),  # Use density for y-axis
                 binwidth = 1,
                 color = "orange",
                 fill = "purple",
                 alpha = 0.7) +  # Opacity
  geom_density(color = "blue",           # Color of the KDE curve
               size = 1,                 # Thickness of the curve
               adjust = 1) +             # Adjust bandwidth for fitting
  labs(x = "SPIN Log Total Score", 
       y = "Density",                  # Change to Density for y-axis
       title = "SPIN Log Distribution with KDE") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

qqnorm(df$log_SPIN_T, main="Q-Q plot for Log SPIN") 
qqline(df$log_SPIN_T)


```

```{r}
# boxplot(mlb$height, main="Boxplot of Baseball Player Height", ylab="Height (inches)", col = 'red' )
# ggplot(mlb, aes(y=height)) + 
#   geom_boxplot() + 
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Boxplot of Baseball Player Height using `ggplot`", x="", y = "Height (inches)")
```

Now the Q-Q plot, adding a theoretical line to the plot.

```{r}
# qqnorm(mlb$height, main="Q-Q plot of Baseball Player Heights") 
# qqline(mlb$height)
# shapiro.test(mlb$height) # Shapiro-Wilk test for normality
# ks.test(mlb$height,pnorm) # Kolmogorov-Smirnov Tests against normal distribution
```


#### Standardizing 


``` {r, standardizing}
df$GAD_T_Stand <- scale(df$GAD_T)
df$SWL_T_Stand <- scale(df$SWL_T)
df$SPIN_T_Stand <- scale(df$SPIN_T)
```

``` {r, plotting_newGAD}
ggplot(data = df, aes(x = GAD_T_Stand)) +
  geom_histogram(binwidth = 1,
                 color = "red",
                 fill = "blue",
                 alpha = .7) + # opacity
  labs(x = "GAD Standardized", y = "Frequency", title = "GAD Stand Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

qqnorm(df$GAD_T_Stand, main="Q-Q plot for Stand GAD") 
qqline(df$GAD_T_Stand)
```

``` {r, plotting_newSWL}
# Create the histogram with a KDE curve
ggplot(data = df, aes(x = SWL_T_Stand)) +
  geom_histogram(aes(y = ..density..),  # Use density for y-axis
                 binwidth = 1,
                 color = "orange",
                 fill = "purple",
                 alpha = 0.7) +  # Opacity
  geom_density(color = "blue",           # Color of the KDE curve
               size = 1,                 # Thickness of the curve
               adjust = 1) +             # Adjust bandwidth for fitting
  labs(x = "GAD Stand Log Total Score", 
       y = "Density",                  # Change to Density for y-axis
       title = "GAD Stand Distribution with KDE") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

qqnorm(df$SWL_T_Stand, main="Q-Q plot for Stand SWL") 
qqline(df$SWL_T_Stand)
```

``` {r, plotting_newSPIN}
# Create the histogram with a KDE curve
ggplot(data = df, aes(x = SPIN_T_Stand)) +
  geom_histogram(aes(y = ..density..),  # Use density for y-axis
                 binwidth = 1,
                 color = "orange",
                 fill = "purple",
                 alpha = 0.7) +  # Opacity
  geom_density(color = "blue",           # Color of the KDE curve
               size = 1,                 # Thickness of the curve
               adjust = 1) +             # Adjust bandwidth for fitting
  labs(x = "GAD Stand Log Total Score", 
       y = "Density",                  # Change to Density for y-axis
       title = "GAD Stand Distribution with KDE") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

qqnorm(df$SPIN_T_Stand, main="Q-Q plot for Stand SPIN") 
qqline(df$SPIN_T_Stand)

mean_spin = mean(df$SPIN_T_Stand, na.rm = TRUE)
mean_spin
```

### Converstion to Ordinal (thinking that maybe a screenshot of how we present the info the slides would make it clear for a non-technical audience?)

``` {r, ord}
# Function to convert GAD_T to ordinal variable
convert_GAD <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 0 & score <= 4) {
    return("minimal anxiety")
  } else if (score >= 5 & score <= 9) {
    return("mild anxiety")
  } else if (score >= 10 & score <= 14) {
    return("moderate anxiety")
  } else if (score >= 15 & score <= 21) {
    return("severe anxiety")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}

# Function to convert SWL_T to ordinal variable
convert_SWL <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 31 & score <= 35) {
    return("extremely satisfied")
  } else if (score >= 26 & score <= 30) {
    return("satisfied")
  } else if (score >= 21 & score <= 25) {
    return("slightly satisfied")
  } else if (score == 20) {
    return("neutral")
  } else if (score >= 15 & score <= 19) {
    return("slightly dissatisfied")
  } else if (score >= 10 & score <= 14) {
    return("dissatisfied")
  } else if (score >= 5 & score <= 9) {
    return("extremely dissatisfied")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}

# Function to convert SPIN_T to ordinal variable
convert_SPIN <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 0 & score <= 20) {
    return("none")
  } else if (score >= 21 & score <= 30) {
    return("mild")
  } else if (score >= 31 & score <= 40) {
    return("moderate")
  } else if (score >= 41 & score <= 50) {
    return("severe")
  } else if (score >= 51 & score <= 68) {
    return("very severe")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}


# Create new columns in the data frame
df$GAD_ord <- sapply(df$GAD_T, convert_GAD)
df$SWL_ord <- sapply(df$SWL_T, convert_SWL)
df$SPIN_ord <- sapply(df$SPIN_T, convert_SPIN)

#make values ordinal (min to max)
df$GAD_ord <- factor(df$GAD_ord, 
                     levels = c("minimal anxiety", "mild anxiety", "moderate anxiety", "severe anxiety"), 
                     ordered = TRUE)

df$SWL_ord <- factor(df$SWL_ord, 
                     levels = c("extremely satisfied", "satisfied", "slightly satisfied", "neutral", 
                                "slightly dissatisfied", "dissatisfied", "extremely dissatisfied"), 
                     ordered = TRUE)

df$SPIN_ord <- factor(df$SPIN_ord, 
                      levels = c("none", "mild", "moderate", "severe", "very severe"), 
                      ordered = TRUE)


# Print the updated data frame
#print(df$GAD_ord)

```


### cleaning whyplay (thinking that maybe a screenshot of how we present the info the slides would make it clear for a non-technical audience?)

``` {r, cleaningwhyplay}
clean_responses <- function(response) {
  response <- trimws(tolower(response))  # Normalize to lowercase and trim whitespace
  
  # Check for exact matches first
  if (response %in% c("winning", "improving", "relaxing", "having fun")) {
    return(response)
  }
  
  # Check for various conditions to set the response
  if (str_detect(response, "^a[\\s,\\.]", ) || 
      str_detect(response, "^1[\\s,\\.]", ) || 
      str_detect(response, "^all") || 
      str_detect(response, "^mix") || 
      str_detect(response, "combination") || 
      str_detect(response, "everything")) {
    return("all of the above")
  }
  
  if (str_detect(response, "distraction|escaping|escape|forget|hide|hiding|depression|boredom|bored|time|forgetting|making my brain go numb|distracting|doing something|getting away from real life|trying to get my mind off")) {
    return("escape")
  }

  if (str_detect(response, "improve|improving|learn|learning")) {
    return("improving")
  }
  
  if (str_detect(response, "well|perform|performing")) {
    return("winning")
  }
  
  if (str_detect(response, "social|socializing|friends|team|cooperating|people|the people i play with, the game is less important")) {
    return("social")
  }
  
  if (str_detect(response, "win|winning|beating|victory|competeing|competing|competition|conpeting")) {
    return("winning")
  }
  
  if (str_detect(response, "winning") && str_detect(response, "improving")) {
    return("mix")
  }
  
  if (str_detect(response, "relaxing") && str_detect(response, "fun")) {
    return("mix")
  }
  
  if (str_detect(response, "combination|all")) {
    return("mix")
  }
  
  if (str_detect(response, "fun")) {
    return("having fun")
  }
  
  # Default to original response if no condition is met
  return("bad response")
}

# Apply the cleaning function to the 'whyplay' column
df$cleaned_whyplay <- sapply(df$whyplay, clean_responses)

# Count the occurrences of each cleaned response
whyplay_counts <- as.data.frame(table(df$cleaned_whyplay))
```

```{r, why }

colnames(whyplay_counts) <- c("WhyPlay", "SurveyCount")


whyplay_counts <- whyplay_counts[order(-whyplay_counts$SurveyCount), ]


whyplay_counts$WhyPlay <- factor(whyplay_counts$WhyPlay, levels = whyplay_counts$WhyPlay)


fig <- ggplot(whyplay_counts, aes(x = WhyPlay, y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Reasons for Playing', 
       subtitle = '', 
       caption = 'Data Source: Survey Data', 
       x = 'Reasons for Playing', 
       y = 'Total Respondents') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))


print(fig)
```

### Removing Outliers in Hours and Streams

kvfvdfvdfv

Hours and streams combitnation to Total Hours

Correlation?

### Hours Converstion of Ordinal

sdcdscsdcsdcsdc












## Hypothesis Tests (add in any I am missing or change the names in needed. Each test will have a visualization)

words on each of the test we ran and why


### Hours Played and Hours Streamed (ANOVA)


This very weak negative correlation means that an increase in hours played slightly results in a lower SWL score (less life satisfaction).

### Inventories and Hours Played (ANOVA)


### GADE and WhyPlay (chi-sqaured)
.......

### Inventories and WhyPlay (chi-sqauared)

......


## Keys Findings 

Here we will restate the key fidnings for each test, why they matter, and what it tells us about gaming and mental health.

## Reccomednations 

Here we will state what we think should be done next (project part 2)

"We reccomedn running a logisitic regression blah blah blah" 






