---
title: "Mental Health Outcomes in Gamers"
author: "Team 5 -- DATS 6101"
# date: "today"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: show
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=F}
library(ezids)
library(readr)
library(ggplot2)
library(dplyr)
library(stringr)
library(rstatix)
library(knitr)
library(kableExtra)
library(reshape2)
library(gridExtra)
library(patchwork)
```


```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(warning = F, results = "markup", message = F)
options(scientific=T, digits = 3) 
```

```{r read-in, include=TRUE}
df <- read.csv("GamingStudy_data.csv")
```


## Introduction
Video games are a common pastime for today's generation. With the various advancements in graphics and the internet itself, the immersion of video games continues to increase. One topic we wanted to research was the gaming habits of people with psychological struggles. 

### Reasearch Question

Does a person’s video game habits, seen in hours spent playing and streaming, affect their mental health?

### The Data

This data set (https://www.kaggle.com/datasets/divyansh22/online-gaming-anxiety-data/data) surveyed 13,464 gamers and had them answer questions not only about time spent playing video games, but it also asked questions that are typically seen in psychological diagnosis tests approved in the Diagnostic and Statistical Manual of Mental Disorders (DSM). Please note that the terms gamers and surveyors will be used interchangeably in this report.

### Mental Health Inventories and Predictors 

This is the list of mental health indicators.

1. GAD-7 (Generalized Anxiety Disorder, 7 questions)

2. GADE (Generalized Anxiety Disorder, Effect in Life)

3. SWL (Satisfaction with Life)

4. SPIN (Social Phobia Inventories)

This is the list of mental health predictors.

1. Hours: the hours per week playing video games

2. Streams: the hours per week spent streaming video games

3. whyplay: the reason why surveyors play video games

4. Age: the number of years a surveyor is when the survey was completed

5. Gender: the sex of surverors

6. Game Played: the selected game surveyors play the most


## Exploratory Data Analysis 

In order to start answering our research question, we need to examine our data. This will include investigating demographic data, psychological inventory scores, and ensuring standardized metrics for times and reasoning.

### Assumption of Continuity

In our EDA, we noticed that the data for the psychological inventories was not truly continuous. This was made apparent when attempting logarithmic and scale transformations. However, due to the level of difficulty this course is expecting us to perservere, we are assuming normality for all variables.

### Demographics

First, we need to examine the demographics of surveyors. Since we have age, gender, country of residence, and game played, let's see what we can find out.

``` {r, age}
age_counts <- as.data.frame(table(df$Age))
colnames(age_counts) <- c("Age", "SurveyCount")
age_counts <- age_counts[order(-age_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(age_counts, aes(x = reorder(Age, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Age Distribution', 
       subtitle = '', 
       x = 'Age', 
       y = 'Total Respondents') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)

```

The age histogram tells us that gamers who are 18 years old make up most of the surveyors, followed by 19 and 20 year old gamers. This means age is extremely right skewed.

``` {r, genderplot}
gender_counts <- as.data.frame(table(df$Gender))
colnames(gender_counts) <- c("Gender", "SurveyCount")
gender_counts <- gender_counts[order(-gender_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(gender_counts, aes(x = reorder(Gender, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Gender Distribution', 
       subtitle = '', 
       x = '', 
       y = 'Total Respondents') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)
```

The respondents/surveyors are almost entirely males. This is another, significant right-skewed variable.

``` {r, countryplot}
Residence_counts <- as.data.frame(table(df$Residence))
colnames(Residence_counts) <- c("Residence", "SurveyCount")
Residence_counts <- Residence_counts[order(-Residence_counts$SurveyCount), ]

# Keep only the top 10 residences
top_10_residences <- head(Residence_counts, 10)

# Create the plot
fig <- ggplot(top_10_residences, aes(x = reorder(Residence, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  geom_text(aes(label = SurveyCount), vjust = -0.5, color = 'white') +
  labs(title = 'Top 10 Residences Distribution', 
       x = '', 
       y = 'Total Surveyors') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Print the figure
print(fig)
```

Interestingly, we see that most of the surveyors reside in the United States of America. Since there were a lot of countries available for selection in the survey, we limited the histogram to only show the top 10 countries.

``` {r, gameplot}
game_counts <- as.data.frame(table(df$Game))
colnames(game_counts) <- c("Game", "SurveyCount")
game_counts <- game_counts[order(-game_counts$SurveyCount), ]

# Create the plot
fig <- ggplot(game_counts, aes(x = reorder(Game, -SurveyCount), y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Game Distribution', 
       subtitle = '', 
       x = '', 
       y = 'Total Surveyors') +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_minimal()  +
 theme(plot.title = element_text(hjust = 0.5))
# Print the figure
print(fig)
```

Finally, we see that the game most played is League of Legends, a multi-player battle arena video game. While this also makes this variable right-skewed, it also informs us that the data analyzed for this project is applicable primarily for gamers who engage in multi-player/online mediums. League of Legends happens to be the best represented in our data.

To summarize the demographics of our data, we are mostly looking at 18 year old males that reside in the United States and play League of Legends.

### Psychological Inventories

Now that we know the demographics of our data, it's time to look at the scores of the four psychological inventories. 

```{r, gad_dist}
ggplot(data = df, aes(x = GAD_T)) +
  geom_histogram(binwidth = 1,
                 color = "red",
                 fill = "blue",
                 alpha = .7) + # opacity
  labs(x = "GAD Total Score", y = "Frequency", title = "GAD Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

For GAD-7, interestingly, most of the total scores are either zero or two. Scores from zero to four indicate minimal symptoms of anxiety. Scores from five to nine indicate mild symptoms of anxiety, potentially indicating sub-clinical GAD. Scores from ten to fourteen indicate moderate symptoms of anxiety, likely indicating GAD. Scores from fifteen to twenty-one indicate severe symptoms of anxiety, strongly suggesting GAD. This right skew means that there are a lot of surveyors who experience minimal symptoms of generalized anxiety. 

```{r, gade_dist}
# Reorder the GADE factor levels
df$GADE <- factor(df$GADE, levels = c("Not difficult at all", "Somewhat difficult", "Very difficult", "Extremely difficult", NA))

# Plot the histogram of reordered GADE values
ggplot(df, aes(x = GADE)) +
  geom_bar(fill = "skyblue") +
  labs(title = "Histogram of GADE Values",
       x = "GADE (Difficulty Level)",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

For GADE, there are a lot of surveyors that have indicated they can function "appropriately" in society, shown in the 'Not difficult at all' bar. This means that the effect generalized anxiety may have in their life is extremely minimal. The data here is very right-skewed, as with the other variables where EDA has been performed.

```{r, swl_dist}
ggplot(data = df, aes(x = SWL_T)) +
  geom_histogram(binwidth = 1,
                 color = "pink",
                 fill = "green",
                 alpha = .7) + # opacity
  labs(x = "SWL Total Score", y = "Frequency", title = "SWL Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

For SWL, this appears to be the most normally distributed, with most surveyors having scores in the low to mid twenties. The higher the score, the more satisfied with life a person is. The lower the score, the more dissatisfied with life a person is.

```{r, spin_dist}
ggplot(data = df, aes(x = SPIN_T)) +
  geom_histogram(binwidth = 1,
                 color = "orange",
                 fill = "magenta",
                 alpha = .7) + # opacity
  labs(x = "SPIN Total Score", y = "Frequency", title = "SPIN Distribution") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

For SPIN, the data is slightly less skewed; we see that the most frequent score is around 14 or 15, indicating minimal social anxiety. The lower the score, the less likely one experiences social anxieties and phobias. The higher the score, the more likely one experiences social anxieties and phobias.

### Standarized Metrics for Psychological Inventories

Immediately we see that the total scores for all the psychological inventories need to be standardized into their respective categories of minimal and severe. Once the conversion of raw scores into ordinal values is complete, we can get a better representation of how each psychological inventory affects gamers.

``` {r, ord}
# Function to convert GAD_T to ordinal variable
convert_GAD <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 0 & score <= 4) {
    return("minimal anxiety")
  } else if (score >= 5 & score <= 9) {
    return("mild anxiety")
  } else if (score >= 10 & score <= 14) {
    return("moderate anxiety")
  } else if (score >= 15 & score <= 21) {
    return("severe anxiety")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}

# Function to convert SWL_T to ordinal variable
convert_SWL <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 31 & score <= 35) {
    return("extremely satisfied")
  } else if (score >= 26 & score <= 30) {
    return("satisfied")
  } else if (score >= 21 & score <= 25) {
    return("slightly satisfied")
  } else if (score == 20) {
    return("neutral")
  } else if (score >= 15 & score <= 19) {
    return("slightly dissatisfied")
  } else if (score >= 10 & score <= 14) {
    return("dissatisfied")
  } else if (score >= 5 & score <= 9) {
    return("extremely dissatisfied")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}

# Function to convert SPIN_T to ordinal variable
convert_SPIN <- function(score) {
  if (is.na(score)) return(NA)  # Handle NA values
  if (score >= 0 & score <= 20) {
    return("none")
  } else if (score >= 21 & score <= 30) {
    return("mild")
  } else if (score >= 31 & score <= 40) {
    return("moderate")
  } else if (score >= 41 & score <= 50) {
    return("severe")
  } else if (score >= 51 & score <= 68) {
    return("very severe")
  } else {
    return(NA)  # Handles scores outside defined range
  }
}

# Function to convert hours to ordinal variable
convert_hours <- function(hours) {
  if (is.na(hours)) return(NA)  # Handle NA values
  if (hours >= 0 & hours <= 10) {
    return("Low")
  } else if (hours > 10 & hours <= 20) {
    return("Moderate")
  } else if (hours > 20 & hours <= 30) {
    return("High")
  } else if (hours > 30) {
    return("Very High")
  } else {
    return(NA)  # Handles any unexpected values
  }
}

# Create new columns in the data frame
df$GAD_ord <- sapply(df$GAD_T, convert_GAD)
df$SWL_ord <- sapply(df$SWL_T, convert_SWL)
df$SPIN_ord <- sapply(df$SPIN_T, convert_SPIN)
df$hours_ord <- sapply(df$Hours, convert_hours)


#make values ordinal (min to max)
df$GAD_ord <- factor(df$GAD_ord, 
                     levels = c("minimal anxiety", "mild anxiety", "moderate anxiety", "severe anxiety"), 
                     ordered = TRUE)

df$SWL_ord <- factor(df$SWL_ord, 
                     levels = c("extremely satisfied", "satisfied", "slightly satisfied", "neutral", 
                                "slightly dissatisfied", "dissatisfied", "extremely dissatisfied"), 
                     ordered = TRUE)

df$SPIN_ord <- factor(df$SPIN_ord, 
                      levels = c("none", "mild", "moderate", "severe", "very severe"), 
                      ordered = TRUE)

df$hours_ord <- factor(df$hours_ord, 
                            levels = c("Low", "Moderate", "High", "Very High"), 
                            ordered = TRUE)


# Print the updated data frame
#print(df$GAD_ord)
```

```{r GAD_ord_dist}
ggplot(df, aes(x = GAD_ord)) +
  geom_bar(fill = "blue") +
  labs(title = "Histogram of Ordinal GAD Values",
       x = "Ordinal GAD Values",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GAD is still right-skewed, but we can see that most gamers experience minimal anxiety. Since GADE has already been displayed in the correct order, we can move onto SWL.

```{r SWL_ord_dist}
ggplot(df, aes(x = SWL_ord)) +
  geom_bar(fill = "green") +
  labs(title = "Histogram of Ordinal SWL Values",
       x = "Ordinal SWL Values",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

SPIN is interestingly bi-modal, with 'Slightly satisfied' and 'Slightly dissatisfied' being the most common selections chosen.

```{r SPIN_ord_dist}
ggplot(df, aes(x = SPIN_ord)) +
  geom_bar(fill = "magenta") +
  labs(title = "Histogram of Ordinal SPIN Values",
       x = "Ordinal SPIN Values",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

SPIN is right-skewed, where most gamers indicated they experience no social anxieties or phobias.

### Reason for playing

When looking at all of this data, a crucial component is the reason why gamers play video games in the first place. Since this field was a free-response, it would be impossible, and unwise, to display a histogram of every possible response received. In order to show meaningful results, we will use regular expressions to isolate key words in the responses and categorize them under a specific group.

``` {r, cleaningwhyplay}
clean_responses <- function(response) {
  response <- trimws(tolower(response))  # Normalize to lowercase and trim whitespace
  
  # Check for exact matches first
  if (response %in% c("winning", "improving", "relaxing", "having fun")) {
    return(response)
  }
  
  # Check for various conditions to set the response
  if (str_detect(response, "^a[\\s,\\.]", ) || 
      str_detect(response, "^1[\\s,\\.]", ) || 
      str_detect(response, "^all") || 
      str_detect(response, "^mix") || 
      str_detect(response, "combination") || 
      str_detect(response, "everything")) {
    return("all of the above")
  }
  
  if (str_detect(response, "distraction|escaping|escape|forget|hide|hiding|depression|boredom|bored|time|forgetting|making my brain go numb|distracting|doing something|getting away from real life|trying to get my mind off")) {
    return("escape")
  }

  if (str_detect(response, "improve|improving|learn|learning")) {
    return("improving")
  }
  
  if (str_detect(response, "well|perform|performing")) {
    return("winning")
  }
  
  if (str_detect(response, "social|socializing|friends|team|cooperating|people|the people i play with, the game is less important")) {
    return("social")
  }
  
  if (str_detect(response, "win|winning|beating|victory|competeing|competing|competition|conpeting")) {
    return("winning")
  }
  
  if (str_detect(response, "winning") && str_detect(response, "improving")) {
    return("mix")
  }
  
  if (str_detect(response, "relaxing") && str_detect(response, "fun")) {
    return("mix")
  }
  
  if (str_detect(response, "combination|all")) {
    return("mix")
  }
  
  if (str_detect(response, "fun")) {
    return("having fun")
  }
  
  # Default to original response if no condition is met
  return("bad response")
}

# Apply the cleaning function to the 'whyplay' column
df$cleaned_whyplay <- sapply(df$whyplay, clean_responses)

# Count the occurrences of each cleaned response
whyplay_counts <- as.data.frame(table(df$cleaned_whyplay))
```

```{r, why }

colnames(whyplay_counts) <- c("WhyPlay", "SurveyCount")


whyplay_counts <- whyplay_counts[order(-whyplay_counts$SurveyCount), ]


whyplay_counts$WhyPlay <- factor(whyplay_counts$WhyPlay, levels = whyplay_counts$WhyPlay)


fig <- ggplot(whyplay_counts, aes(x = WhyPlay, y = SurveyCount)) +
  geom_bar(stat = 'identity', fill = '#232A75') +
  labs(title = 'Reasons for Playing', 
       subtitle = '', 
       caption = 'Data Source: Survey Data', 
       x = 'Reasons for Playing', 
       y = 'Total Respondents') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))


print(fig)
```

Now we can see that most gamers play either for fun or to improve their skills. One quick note: the group 'Escape' does not refer to escaping responsibilities. It is more along the lines of dissociation and depression.

### Hours Played

Now that we know why gamers play video games, we want to see how long they play per week. However, we want to first see the data shown in categories of low (0 - 10 hours), moderate (11 - 20 hours), high (21 -30 hours), and very high (over 30 hours). 

```{r hours_ord_dist}
ggplot(df, aes(x = hours_ord)) +
  geom_bar(fill = "turquoise") +
  labs(title = "Histogram of Ordinal Hours Playing Video Games per Week",
       x = "Ordinal Hours Values",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

We can see that most gamers play from 11 - 20 hours per week, which is the moderate group. This distribution is slightly less skewed compared to the other variables where EDA has been performed. 

### Identifying outliers in Hours

In order to find relationship between time spent playing games and its effect on a person's mental health, we need to explore the variable Hours spent (per week) playing video games. We generate a histogram to see its distribution.

```{r}

# Replace missing values in the Hours column with NA explicitly
hrs_data_cleaned <- df %>%
  mutate(Hours = ifelse(is.na(Hours), NA, Hours))
missing_values <- colSums(is.na(hrs_data_cleaned))

# Filter necessary columns
hrs_GAD_filtered <- hrs_data_cleaned %>%
  select(Hours, GAD1:GAD7, GAD_T)

# Finding outliers in Hours
fig_hours <- ggplot(hrs_GAD_filtered, aes(x = Hours)) + 
  geom_boxplot(colour = "orange", fill = "#7777cc", outlier.colour = "red", outlier.shape = 8, outlier.size = 5) +
  labs(title = "Outliers in Hours spent gaming per week", 
       subtitle = '', 
       caption = 'Data Source: Survey Data', 
       x = "Hours Spent (per week)", 
       y = '') +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center and bold title
    axis.title.x = element_text(hjust = 0.5), # Bold and center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Bold and center y-axis label
  )

print(fig_hours)

```

We see that the data sure has anomaly because it's impossible to have 8000 hours in a week! So in order to use this variable, such extreme values need to be removed.

### Removing outliers in Hours and generating Q-Q plot, histogram and boxplot

We now use a function to remove the extreme values from Hours played variable and generate QQ-plot, histogram and boxplot and check the data distribution again.

```{r}
# Define the outlierKD2 function
outlierKD2 <- function(dt, var, rm = TRUE, boxplt = TRUE, qqplt = TRUE) { 
  var_name <- eval(substitute(var),eval(dt))
  na1 <- sum(is.na(var_name))
  m1 <- mean(var_name, na.rm = TRUE)
  
  # Generate boxplot and histogram (before removing outliers)
  if (boxplt) {
    par(mfrow = c(2, 2), oma = c(0, 0, 3, 0))
    boxplot(var_name, main = "With outliers")
    hist(var_name, main = "With outliers", xlab = NA, ylab = NA)
  }
  
  outlier <- boxplot.stats(var_name)$out
  mo <- mean(outlier)
  
  var_name <- ifelse(var_name %in% outlier, NA, var_name)
  
  # Generate boxplot and histogram (after removing outliers)
  if (boxplt) {
    boxplot(var_name, main = "Without outliers")
    hist(var_name, main = "Without outliers", xlab = NA, ylab = NA)
  }
  
  # Generate QQ plot if requested
  if (qqplt) {
    qqnorm(var_name)
    qqline(var_name)
  }
  
  na2 <- sum(is.na(var_name))
  
  cat("Outliers identified:", na2 - na1, "\n")
  cat("Proportion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name)) * 100, 1), "\n")
  cat("Mean of the outliers:", round(mo, 2), "\n")
  m2 <- mean(var_name, na.rm = TRUE)
  cat("Mean without removing outliers:", round(m1, 2), "\n")
  cat("Mean if we remove outliers:", round(m2, 2), "\n")
  
  # Option to remove outliers (replace with NA)
  if (rm) {
    dt[[as.character(substitute(var))]] <- invisible(var_name)
    assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
    cat("Outliers successfully removed\n")
    return(invisible(dt))
  } else {
    cat("Nothing changed\n")
    return(invisible(var_name))
  }
}

# Apply outlierKD2 to remove outliers from 'Hours'
hrs_GAD_filtered_clean <- outlierKD2(hrs_GAD_filtered, Hours, rm = TRUE, boxplt = FALSE, qqplt = TRUE)

# Create a histogram using ggplot
ggplot(hrs_GAD_filtered_clean, aes(x = Hours)) + 
  geom_histogram(fill = "lightblue", binwidth = 1, color = "black") +
  labs(title = "Histogram of Hours Spent Gaming (Outliers Excluded)", 
       x = "Hours Spent (per week)", 
       y = "Frequency", 
       caption = "Data Source: Survey Data") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center and bold title
    axis.title.x = element_text(hjust = 0.5), # Bold and center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Bold and center y-axis label
  )

# Create a boxplot using ggplot
ggplot(hrs_GAD_filtered_clean, aes(x = Hours)) + 
  geom_boxplot(colour = "orange", fill = "#7777cc", outlier.colour = "red", outlier.shape = 8, outlier.size = 4) +
  labs(title = "Hours spent Gaming per week (Outliers Excluded)", 
       x = "Hours Spent (per week)", 
       y = "", 
       caption = "Data Source: Survey Data") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center and bold title
    axis.title.x = element_text(hjust = 0.5), # Bold and center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Bold and center y-axis label
  )


```

After cleaning the Hours played variable, the Q-Q plot suggests that the center of the data could be more or less normally distributed, but the tails have more or fewer outliers. The histogram confirms that as we can see most frequent values are in the middle portion of the data. The wide shape of the boxplot confirms that the data is widely spread out and the median being close to the upper end indicates that the data is slightly left-skewed.  


### Streams
### Identifying outliers in Streams

We also need to explore the variable streams to know the time spent on watching Streams, Tournaments, etc. (per week) which could have relation on a person's health. We generate a histogram to see its distribution.

```{r}
ggplot(df, aes(x = streams)) + 
  geom_boxplot(colour = "orange", fill = "#7777cc", outlier.colour = "red", outlier.shape = 8, outlier.size = 4) +
  labs(title = "Outliers in time spent on streaming (per week)", 
       x = "Time spent on Streaming (per week)", 
       y = "") +
  theme_minimal() +  # Apply minimal theme
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.title.x = element_text(hjust = 0.5), # Center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Center y-axis label
  )

```

It is evident from the plot above that similar to the data of time spent on playing online games, the time spent on watching streams per week also has anomalies. We proceed to remove these extreme values in the next step.


### Removing outliers in Streams and generating Q-Q plot, histogram and boxplot

```{r}

# Define the outlierKD2 function
outlierKD2 <- function(dt, var, rm = TRUE, boxplt = TRUE, qqplt = TRUE) { 
  var_name <- eval(substitute(var), eval(dt))
  na1 <- sum(is.na(var_name))
  m1 <- mean(var_name, na.rm = TRUE)
  
  # Generate plots (boxplot and histogram)
  if (boxplt) {
    par(mfrow = c(2, 2), oma = c(0, 0, 3, 0))
    boxplot(var_name, main = "With outliers")
    hist(var_name, main = "With outliers", xlab = NA, ylab = NA)
  }
  
  outlier <- boxplot.stats(var_name)$out
  mo <- mean(outlier)
  
  var_name <- ifelse(var_name %in% outlier, NA, var_name)
  
  if (boxplt) {
    boxplot(var_name, main = "Without outliers")
    hist(var_name, main = "Without outliers", xlab = NA, ylab = NA)
  }
  
  # Generate QQ plot if requested
  if (qqplt) {
    qqnorm(var_name)
    qqline(var_name)
  }
  
  na2 <- sum(is.na(var_name))
  
  cat("Outliers identified:", na2 - na1, "\n")
  cat("Proportion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name)) * 100, 1), "\n")
  cat("Mean of the outliers:", round(mo, 2), "\n")
  m2 <- mean(var_name, na.rm = TRUE)
  cat("Mean without removing outliers:", round(m1, 2), "\n")
  cat("Mean if we remove outliers:", round(m2, 2), "\n")
  
  # Option to remove outliers (replace with NA)
  if (rm) {
    dt[[as.character(substitute(var))]] <- invisible(var_name)
    assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
    cat("Outliers successfully removed\n")
    return(invisible(dt))
  } else {
    cat("Nothing changed\n")
    return(invisible(var_name))
  }
}

# Use outlierKD2 to remove outliers from 'streams'
df_clean <- outlierKD2(df, streams, rm = TRUE, boxplt = FALSE, qqplt = TRUE)

# Histogram of cleaned data
hist(df_clean$streams, main = "Histogram of Time Spent Watching Streams (hrs/week)", 
     xlab = "Time Spent Watching Streams (hrs/week)", col = "lightblue")

# Boxplot of cleaned data
ggplot(df_clean, aes(x = streams)) + 
  geom_boxplot(colour = "orange", fill = "#7777cc", outlier.colour = "red", outlier.shape = 8, outlier.size = 4) +
  labs(title = "Time Spent Streaming per week (Outliers Excluded)", 
       x = "Streaming (per week)", 
       y = "") +
  theme_minimal() +  # Apply minimal theme
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    axis.title.x = element_text(hjust = 0.5), # Center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Center y-axis label
  )


```

Even after removing the outliers, we find the data to be not normally distributed (as seen in the Q-Q plot). The histogram confirms this as we find more data towards the lower tail compared to the upper tail. The long length of the whisker of the boxplot confirms this as well.


### Hours and Streams (Pearson's Correlation)

We now conduct the Pearson's correlation test to measure the strength and direction of the linear relationship between Hours spent gaming and Hours spent watching streams:


```{r, corr_h_s}
cor_test <- cor.test(hrs_GAD_filtered_clean$Hours, df_clean$streams)
correlation_result_Hours_Streams <- cor(hrs_GAD_filtered_clean$Hours, df_clean$streams, method = "pearson", use = "complete.obs")
cor_test
```

The Correlation coefficient value (0.0844) indicates a weak positive linear relationship between the two variables, Hours and Streams. Since the correlation is close to 0, the relationship is not strong, meaning that as Hours (time spent gaming) increases, the time spent streaming (or vice versa) increases slightly, but not in a very consistent or strong way.

### Standardizing Hours and Streams cleaned data

Now since the data of both the time spent on playing games and watching streams and tournaments are not normally distributed, we try to standardize these data in order to proceed with the tests that assume normality.


``` {r}
df_clean$streams_Stand <- scale(df_clean$streams)
hrs_GAD_filtered_clean$hours_Stand <- scale(hrs_GAD_filtered_clean$Hours)

```

### Hours spent gaming Q-Q plot and histogram with Standardized values

We generate Q-Q plot and histogram with the Standardized values expecting to get a normal distribution:

```{r, plotting_hours}

# Q-Q plot for standardized Hours
qqnorm(hrs_GAD_filtered_clean$hours_Stand, main = "Q-Q plot for Standardized Hours played gaming")
qqline(hrs_GAD_filtered_clean$hours_Stand)

# Histogram for standardized Hours
ggplot(data = hrs_GAD_filtered_clean, aes(x = hours_Stand)) +
  geom_histogram(binwidth = 1, color = "red", fill = "blue", alpha = .7) +
  labs(x = "Hours played gaming (Standardized)", y = "Frequency", title = "Standardized Hours played gaming distribution (Outliers excluded") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```

As seen from the plots above the data now look near to normal and smoother. Now, we look into the time spent watching streams variable. 

### Streaming Q-Q plot and histogram with Standardized values

We generate Q-Q plot and histogram again expecting to get a bell-shaped histogram from the standardized values of the cleaned stream dataset:

``` {r, plotting_streams}

# Q-Q plot for standardized Streams
qqnorm(df_clean$streams_Stand, main = "Q-Q plot for Standardized time spent streaming")
qqline(df_clean$streams_Stand)

# Histogram for standardized Streams
ggplot(data = df_clean, aes(x = streams_Stand)) +
  geom_histogram(binwidth = 1, color = "red", fill = "blue", alpha = .7) +
  labs(x = "Streams Standardized", y = "Frequency", title = "Time spent streaming (Standardized)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```

Even after standardizing the streaming time values, the plots depict that the standardized values are not yet normal. Both the plots confirm that the data is more concentrated towards the left side.



### Adding Hours and Streams -> Total Time, and creating histogram and QQ-plot

Previously, We have seen from the Pearson correlation test that there exists a very weak positive correlation when we tried to find a relation between hours and streams variables (which are free of outliers) and the both the variables not normally distributed (even after standardization). So now we tried to combine the two time variables and try to see if the combined data can be used for further analysis.

```{r}

# Create the new column hrs_stream_combined in df
df$hrs_stream_combined <- df_clean$streams + hrs_GAD_filtered_clean$Hours

# Q-Q plot for Total Time
qqnorm(df$hrs_stream_combined, main = "Q-Q plot for Total time")
qqline(df$hrs_stream_combined)

# Histogram with minimal theme and bin width of 5
ggplot(data = df, aes(x = hrs_stream_combined)) +
  geom_histogram(binwidth = 5, color = "red", fill = "lightblue", alpha = 0.7) +
  labs(title = "Histogram: Total Time Spent Watching Streams, Tournaments, etc.", 
       x = "Time Spent (hrs/week)", 
       y = "Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5,),  # Center and bold title
    axis.title.x = element_text(hjust = 0.5), # Bold and center x-axis label
    axis.title.y = element_text(hjust = 0.5)  # Bold and center y-axis label
  )


```

We can clearly see from the generated Q-Q plot and histogram that the combined data called (now called Total time spent on watching streaming and playing games) has now look near to normal. This data is now suitable to conduct all kinds of tests that require normality of data.


### Histogram of Total Time distribution on GAD_ordinal variables

We now try to see the distribution of total time spent on playing games and streaming based on GAD ordinal classification (minimal/ mild/ moderate/ severe levels of anxiety). 


```{r}
ggplot(df, aes(x = df$hrs_stream_combined)) +
  geom_histogram(binwidth = 5, fill = "blue", color = "black", alpha = 0.7) +
  facet_wrap(~ GAD_ord) +
  labs(title = "Histogram of Total Time spent on playing games and
       streaming based on GAD ordinal classification",
       x = "Hours Played/Week",
       y = "Count") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center and bold title
    axis.title.x = element_text(hjust = 0.5),  # Center x-axis label
    axis.title.y = element_text(hjust = 0.5)   # Center y-axis label
  )

```

We can see from the above distributions that the hours spent playing games and watching streams is different for different levels of anxiety. This brings us the question if this difference is significantly different or not. We wil look into this when doing hypothesis tests.



### Hours Converstion of Ordinal



## Hypothesis Tests (add in any I am missing or change the names if needed. Each test will have a visualization)

For hours spent playing and hours spent streaming, an ANOVA test will be conducted to see if there is a significant difference among the different ordinal categories of hours played and hours spent streaming.

For each of the psychological inventories and hours spent playing, ANOVA tests will be conducted to see if there are significant differences among the different ordinal categories of each psychological inventory and hours spent playing.

For GADE and the reason for playing, a chi-squared test will be conducted to see if the two variables are independent of each other.

For each of the psychological inventories and the reason for playing, chi-squared tests will be conducted to see if the variables are independent of each other.

### Hours Playing and Streaming (ANOVA)

Null Hypothesis (H₀): There is no significant difference in time spent streaming video games and the different hours played categories. $\mu$<sub>low</sub> = $\mu$<sub>moderate</sub> = $\mu$<sub>high</sub> = $\mu$<sub>very high</sub>.

Alternate Hypothesis (H₁): There is a significant difference in  time spent streaming video games and the different hours played categories.

```{r hours_streams_ANOVA}
# Perform one-way ANOVA
anova_result_Hours_Streams <- aov(streams ~ hours_ord, data = df)
p_Hours_Streams <- summary(anova_result_Hours_Streams)[[1]]$`Pr(>F)`[1]
summary(anova_result_Hours_Streams)
```

Since p << 0.05 (p = `r format(p_Hours_Streams, digits = 3)`), we reject the null hypothesis. This means that there is a significant effect hours per week of play time has on a person's total streaming time. In order to see what the effect is, a Tukey's Honest Significant Difference (HSD) post-hoc test must be performed.

```{r TukeyHSD_Hours_Streams}
# Performing Tukey HSD test
tukey_result_Hours_Streams <- TukeyHSD(anova_result_Hours_Streams)

# Print the Tukey HSD results
print(tukey_result_Hours_Streams)

# Plot the Tukey HSD results
plot(tukey_result_Hours_Streams)
```

After performing the post-hoc test, we see that actually there is no significant difference in hours spent streaming and hours spent playing, across all categories.

### GAD and Hours Played (ANOVA)

Null Hypothesis (H₀): There is no significant difference in generalized anxiety disorder scores (GAD_T) across the different hours played categories. $\mu$<sub>low</sub> = $\mu$<sub>moderate</sub> = $\mu$<sub>high</sub> = $\mu$<sub>very high</sub>.

Alternate Hypothesis (H₁): There is a significant difference in generalized anxiety disorder scores across the different hours played categories.

```{r gad_ANOVA}
# Perform one-way ANOVA
anova_result_GAD_Hours <- aov(GAD_T ~ hours_ord, data = df)
p_GAD <- summary(anova_result_GAD_Hours)[[1]]$`Pr(>F)`[1]
summary(anova_result_GAD_Hours)
```

Since p << 0.05 (p = `r format(p_GAD, digits = 3)`), we reject the null hypothesis. This means that there is a significant effect hours per week of play time has on a person's total generalized anxiety disorder score. In order to see what the effect is, a Tukey's Honest Significant Difference (HSD) post-hoc test must be performed.

```{r TukeyHSD_GAD_Hours}
# Performing Tukey HSD test
tukey_result_GAD_Hours <- TukeyHSD(anova_result_GAD_Hours)

# Print the Tukey HSD results
print(tukey_result_GAD_Hours)

# Plot the Tukey HSD results
plot(tukey_result_GAD_Hours)
```

After performing the post-hoc test, we see that there is a significant difference in three categories: Moderate-Low, High-Low, and High-Moderate. We can thereby conclude that there truly is no significant difference in Very High-Low, Very High-Moderate, and Very High-High.

### SWL and Hours Played (ANOVA)

Null Hypothesis (H₀): There is no significant difference in life satisfaction levels (SWL_T) across the different hours played categories. $\mu$<sub>low</sub> = $\mu$<sub>moderate</sub> = $\mu$<sub>high</sub> = $\mu$<sub>very high</sub>.

Alternate Hypothesis (H₁): There is a significant difference in life satisfaction levels  across the different hours played categories.

```{r, swl_ANOVA}
# Perform one-way ANOVA
anova_result_SWL_Hours <- aov(SWL_T ~ hours_ord, data = df)
p_SWL <- summary(anova_result_SWL_Hours)[[1]]$`Pr(>F)`[1]
summary(anova_result_SWL_Hours)
```

Since p << 0.05 (p = `r format(p_SWL, digits = 3)`), we reject the null hypothesis. This means that there is a significant effect hours per week of play time has on a person's total satisfaction with life score. In order to see what the effect is, a Tukey's Honest Significant Difference (HSD) post-hoc test must be performed.

```{r TukeyHSD_SWL_Hours}
# Performing Tukey HSD test
tukey_result_SWL_Hours <- TukeyHSD(anova_result_SWL_Hours)

# Print the Tukey HSD results
print(tukey_result_SWL_Hours)

# Plot the Tukey HSD results
plot(tukey_result_SWL_Hours)
```

After performing the post-hoc test, we see that there is a significant difference in the Moderate-Low category of hours played. We can thereby conclude that there truly is no significant difference in the other five categories. 

### SPIN and Hours Played (ANOVA)

Null Hypothesis (H₀): There is no significant difference in social phobia inventory scores (SPIN_T) across the different hours played categories. $\mu$<sub>low</sub> = $\mu$<sub>moderate</sub> = $\mu$<sub>high</sub> = $\mu$<sub>very high</sub>.

Alternate Hypothesis (H₁): There is a significant difference in social phobia inventory scores across the different hours played categories.

```{r spin_ANOVA}
# Perform one-way ANOVA
anova_result_SPIN_Hours <- aov(SPIN_T ~ hours_ord, data = df)
p_SPIN <- summary(anova_result_SPIN_Hours)[[1]]$`Pr(>F)`[1]
summary(anova_result_SPIN_Hours)
```

Since p << 0.05 (p = `r format(p_SPIN, digits = 3)`), we reject the null hypothesis. This means that there is a significant effect hours per week of play time has on a person's total social phobia inventory score.

```{r TukeyHSD_SPIN_Hours}
# Performing Tukey HSD test
tukey_result_SPIN_Hours <- TukeyHSD(anova_result_SPIN_Hours)

# Print the Tukey HSD results
print(tukey_result_SPIN_Hours)

# Plot the Tukey HSD results
plot(tukey_result_SPIN_Hours)
```

After performing the post-hoc test, we see that there is a significant difference in the Moderate-Low category of hours played. We can thereby conclude that there truly is no significant difference in the other five categories. 

### GADE and WhyPlay (Chi-Squared)

Null Hypothesis (H₀): Being a functional person in society (measured by GADE) and the reason for playing video games are independent of each other.

Alternate Hypothesis (H₁):  Being a functional person in society and the reason for playing video games are not independent. There is some sort of association between them.

```{r contingency_GADE, include=TRUE}
# Define the contingency table
contingency_table_GADE <- table(df$GADE, df$cleaned_whyplay)
print(contingency_table_GADE)

# Perform the chi-squared test
chi_squared_test_GADE <- chisq.test(contingency_table_GADE)
p_GADE_whyplay <- chi_squared_test_GADE$p.value

# Print the result
chi_squared_test_GADE
```

```{r GADE_heatmap}
contingency_melted_GADE <- melt(contingency_table_GADE)

# Plot the heat map for GADE
ggplot(contingency_melted_GADE, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "#7FFFD4", high = "#FF7FAA") +
  labs(title = "Heatmap of Contingency Table for GADE",
       x = "Reason for Playing",
       y = "GADE Level") + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Since p << 0.05 (p = `r format(p_GADE_whyplay, digits = 3)`), we reject the null hypothesis. This means that there is sufficient evidence to suggest an association between being a functional person in society, as measured by GADE, and the reason for playing video games.

### GAD and WhyPlay (Chi-Squared)

Null Hypothesis (H₀): Experiencing symptoms of Generalized Anxiety Disorder and the reason for playing video games are independent of each other.

Alternate Hypothesis (H₁): Experiencing symptoms of Generalized Anxiety Disorder and the reason for playing video games are not independent. There is some sort of association between them.
 
```{r contingency_GAD, include=TRUE}
contingency_table_GAD <- table(df$GAD_ord, df$cleaned_whyplay)

# Print the contingency table
print(contingency_table_GAD)

chi_squared_test_GAD <- chisq.test(contingency_table_GAD)
p_GAD_whyplay <- chi_squared_test_GAD$p.value

# Print the results of the Chi-squared test
chi_squared_test_GAD
```

```{r GAD_heatmap}
contingency_melted_GAD <- melt(contingency_table_GAD)

# Plot the heat map for GAD
ggplot(contingency_melted_GAD, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "#7FFFD4", high = "#FF7FAA") +
  labs(title = "Heatmap of Contingency Table for GAD",
       x = "Reason for Playing",
       y = "GAD Level") + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Since p << 0.05 (p = `r format(p_GAD_whyplay, digits = 3)`), we reject the null hypothesis. This means that there is sufficient evidence to suggest an association between experiencing symptoms of Generalized Anxiety Disorder and the reason for playing video games.

### SWL and WhyPlay (Chi-Squared)

Null Hypothesis (H₀): Life satisfaction and the reason for playing video games are independent of each other.

Alternate Hypothesis (H₁): Life satisfaction and the reason for playing video games are not independent. There is some sort of association between them.
 
```{r contingency_SWL, include=TRUE}
contingency_table_SWL <- table(df$SWL_ord, df$cleaned_whyplay)

# Print the contingency table
print(contingency_table_SWL)

chi_squared_test_SWL <- chisq.test(contingency_table_SWL)
p_SWL_whyplay <- chi_squared_test_SWL$p.value

# Print the results of the Chi-squared test
chi_squared_test_SWL
```

```{r SWL_heatmap}
contingency_melted_SWL <- melt(contingency_table_SWL)

# Plot the heat map for SWL
ggplot(contingency_melted_SWL, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "#7FFFD4", high = "#FF7FAA") +
  labs(title = "Heatmap of Contingency Table for SWL",
       x = "Reason for Playing",
       y = "SWL Level") + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Since p << 0.05 (p = `r format(p_SWL_whyplay, digits = 3)`), we reject the null hypothesis. This means that there is sufficient evidence to suggest an association between life satisfaction and the reason for playing video games.

### SPIN and WhyPlay (Chi-Squared)

Null Hypothesis (H₀): Experiencing social anxiety or phobias and the reason for playing video games are independent of each other.

Alternate Hypothesis (H₁):  Experiencing social anxiety or phobias and the reason for playing video games are not independent. There is some sort of association between them.
 
```{r contingency_SPIN, include=TRUE}
contingency_table_SPIN <- table(df$SPIN_ord, df$cleaned_whyplay)

# Print the contingency table
print(contingency_table_SPIN)

chi_squared_test_SPIN <- chisq.test(contingency_table_SPIN)
p_SPIN_whyplay <- chi_squared_test_SPIN$p.value

# Print the results of the Chi-squared test
chi_squared_test_SPIN
```

```{r SPIN_heatmap}
contingency_melted_SPIN <- melt(contingency_table_SPIN)

# Plot the heat map for SPIN
ggplot(contingency_melted_SPIN, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "#7FFFD4", high = "#FF7FAA") +
  labs(title = "Heatmap of Contingency Table for SPIN",
       x = "Reason for Playing",
       y = "SPIN Level") + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Since p << 0.05 (p = `r format(p_SPIN_whyplay, digits = 3)`), we reject the null hypothesis. This means that there is sufficient evidence to suggest an association between experiencing social anxiety or phobias and the reason for playing video games.


### Inventories and WhyPlay (chi-sqauared)

Based on our theory that the reason why respondents play video games could be an indicators of their mental health, we conducted a chi-squared test of independence against "whyplay" and the inventories. This test determined, with statistical significance, that the "wayplay" and respondents mental healh scores on each of the three inventories are dependent (associated).

```{r contingency, include=TRUE}
contingency_table_gad <- table(df$GAD_ord, df$cleaned_whyplay)


chi_squared_test_gad <- chisq.test(contingency_table_gad)

# Print the results of the Chi-squared test
chi_squared_test_gad
```

```{r contingency3, include=TRUE}
contingency_table_swl <- table(df$SWL_ord, df$cleaned_whyplay)


chi_squared_test_swl <- chisq.test(contingency_table_swl)

# Print the results of the Chi-squared test
chi_squared_test_swl
```

```{r contingency2, include=TRUE}
contingency_table_spin <- table(df$SPIN_ord, df$cleaned_whyplay)



chi_squared_test_spin <- chisq.test(contingency_table_spin)

# Print the results of the Chi-squared test
chi_squared_test_spin
```

In the above chi-sqauared outputs, we see a p-value of 0.00000000000000002. This values, orders of magnitude smaller than 0.05, tells us that "whyplay" and all three inventories are dependent.

The following post-hoc test calculates the adjusted residuals, which in effect are the difference between the expected and actual output. 

``` {r, posthoc}
expected_counts <- chisq.test(contingency_table_gad)$expected

# Calculate residuals
residuals <- contingency_table_gad - expected_counts

# Calculate adjusted residuals
adjusted_residuals <- residuals / sqrt(expected_counts)

# Print adjusted residuals
print(adjusted_residuals)


residuals_df <- melt(adjusted_residuals)

# Create a heatmap
ggplot(residuals_df, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "GAD and WhyPlay Adjusted Residuals Heatmap", x = "GAD Scale", y = "WhyPlay") +
  theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5))


#contingency_df <- as.data.frame(contingency_table_gad)


```


``` {r, posthoc3}
expected_counts <- chisq.test(contingency_table_swl)$expected

# Calculate residuals
residuals <- contingency_table_swl - expected_counts

# Calculate adjusted residuals
adjusted_residuals <- residuals / sqrt(expected_counts)

# Print adjusted residuals
print(adjusted_residuals)



residuals_df <- melt(adjusted_residuals)

# Create a heatmap
ggplot(residuals_df, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "SWL and WhyPlay Adjusted Residuals Heatmap", x = "SWL SCale", y = "WhyPlay") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

#contingency_df <- as.data.frame(contingency_table_swl)


```

``` {r, posthoc2}
expected_counts <- chisq.test(contingency_table_spin)$expected

# Calculate residuals
residuals <- contingency_table_spin - expected_counts

# Calculate adjusted residuals
adjusted_residuals <- residuals / sqrt(expected_counts)

# Print adjusted residuals
print(adjusted_residuals)


residuals_df <- melt(adjusted_residuals)

# Create a heatmap
ggplot(residuals_df, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "SPIN and WhyPlay Adjusted Residuals Heatmap", x = "SPIN Scale", y = "WhyPlay") +
  theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5))


#contingency_df <- as.data.frame(contingency_table_spin)


```

```{r, posthoc_all, fig.width=17}

# GAD heatmap
expected_counts_gad <- chisq.test(contingency_table_gad)$expected
residuals_gad <- contingency_table_gad - expected_counts_gad
adjusted_residuals_gad <- residuals_gad / sqrt(expected_counts_gad)
residuals_df_gad <- melt(adjusted_residuals_gad)

heatmap_gad <- ggplot(residuals_df_gad, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "GAD and WhyPlay Adjusted Residuals Heatmap", x = "GAD Scale", y = "WhyPlay") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# SWL heatmap
expected_counts_swl <- chisq.test(contingency_table_swl)$expected
residuals_swl <- contingency_table_swl - expected_counts_swl
adjusted_residuals_swl <- residuals_swl / sqrt(expected_counts_swl)
residuals_df_swl <- melt(adjusted_residuals_swl)

heatmap_swl <- ggplot(residuals_df_swl, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "SWL and WhyPlay Adjusted Residuals Heatmap", x = "SWL Scale", y = "WhyPlay") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# SPIN heatmap
expected_counts_spin <- chisq.test(contingency_table_spin)$expected
residuals_spin <- contingency_table_spin - expected_counts_spin
adjusted_residuals_spin <- residuals_spin / sqrt(expected_counts_spin)
residuals_df_spin <- melt(adjusted_residuals_spin)

heatmap_spin <- ggplot(residuals_df_spin, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "SPIN and WhyPlay Adjusted Residuals Heatmap", x = "SPIN Scale", y = "WhyPlay") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combine the heatmaps side by side
combined_heatmaps <- heatmap_gad + heatmap_swl + heatmap_spin
combined_heatmaps + plot_layout(ncol = 3)
```

### ANOVA test for Total time spent and GAD_ordinal variables

As we have seen before from the histogram distributions before that the hours spent playing games and watching streams is different for different levels of anxiety. Now in this part we will look if the amount of time people spend on gaming and streaming is signifantly different depending on their level of Generalized Anxiety Disorder (GAD). So we state the following hypotheses:

Null hypothesis: There is no difference in the mean combined hours spent on gaming and streaming among the different levels of GAD.
Alternate hypothesis: At least one group mean of the combined hours spent on gaming and streaming is different from the others among the different levels of GAD.


```{r}

# Combine the hours played and streams into a new variable
df$hrs_stream_combined <- df_clean$streams + hrs_GAD_filtered_clean$Hours

# Perform the ANOVA test
anova_result_combined <- aov(hrs_stream_combined ~ GAD_ord, data = df)

# Summarize the ANOVA results
summary(anova_result_combined)

```

The p-value from the test is very small (2.1e-07), which is much smaller than the common threshold of 0.05. Because the p-value is so small, we can confidently say that the difference in time spent gaming and streaming is not just due to random chance. This means that people with different levels of GAD do indeed spend significantly different amounts of time on gaming and streaming.

So, at least one group (for example, those with mild anxiety) spends a different amount of time gaming and streaming compared to another group (for example, those with severe anxiety). Next yo understand which specific groups are different, we want to conduct post-hoc tests (like Tukey's HSD) to compare the means between each pair of GAD levels.

#### Post hoc test

The Tukey HSD test will compare the means of every possible pair of groups (levels of GAD) to see which means are significantly different from each other.


```{r}
# Perform the ANOVA
anova_result <- aov(hrs_stream_combined ~ GAD_ord, data = df)

# Perform Tukey HSD post-hoc test
tukey_result <- TukeyHSD(anova_result)

# Display the Tukey HSD results
print(tukey_result)

# Optional: Plot the Tukey HSD results
plot(tukey_result)

```

The results suggest that individuals with higher levels of GAD (severe and moderate) tend to spend more combined hours on gaming and streaming compared to those with minimal anxiety. However, the difference between some intermediate levels (e.g., moderate vs. mild) is not statistically significant.



## Keys Findings 

Here we will restate the key findings for each test, why they matter, and what it tells us about gaming and mental health.


#### GAD_T_ordinal based on why they play
```{r GAD_ord vs why_play}


ggplot(df, aes(x = GAD_ord, fill = cleaned_whyplay)) +
  geom_bar(position = "fill") +  # Use position = "fill" to show proportions
  ylab("Proportion") +           # Label the y-axis
  xlab("Severity of the Generalized Anxiety Disorder") +           # Label the x-axis
  labs(title = "Proportion of Reasons for Playing by GAD Scores",
       fill = "Reasons for Playing") +  # Rename the legend title
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Center and bold the title
    axis.title.x = element_text(face = "bold", size = 12),  # Bold and size for x-axis label
    axis.title.y = element_text(face = "bold", size = 12),  # Bold and size for y-axis label
    axis.text.x = element_text(face = "bold", size = 10),   # Bold the x-axis tick labels
    axis.text.y = element_text(face = "bold", size = 10),   # Bold the y-axis tick labels
    legend.title = element_text(face = "bold"),             # Bold the legend title
    legend.text = element_text(face = "bold")               # Bold the legend labels
  )


```

explain

####  GADE_ordinal based on why they play

```{r}
ggplot(df, aes(x = GADE, fill = cleaned_whyplay)) +
  geom_bar(position = "fill") +  # Use position = "fill" to show proportions
  ylab("Proportion") +           # Label the y-axis
  xlab("Generalized Anxiety Disorder Effect in Life") +           # Label the x-axis
  labs(title = "Proportion of Reasons for Playing by GADE Scores",
       fill = "Reasons for Playing") +  # Rename the legend title
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Center and bold the title
    axis.title.x = element_text(face = "bold", size = 12),  # Bold and size for x-axis label
    axis.title.y = element_text(face = "bold", size = 12),  # Bold and size for y-axis label
    axis.text.x = element_text(face = "bold", size = 10, angle = 45, hjust = 1),   # Rotate and bold the x-axis tick labels
    axis.text.y = element_text(face = "bold", size = 10),   # Bold the y-axis tick labels
    legend.title = element_text(face = "bold"),             # Bold the legend title
    legend.text = element_text(face = "bold")               # Bold the legend labels
  )


```

explain

#### SPIN_ord_ordinal based on why they play
```{r SPIN_ord vs why_play}

ggplot(df, aes(x = SPIN_ord, fill = cleaned_whyplay)) +
  geom_bar(position = "fill") +  # Use position = "fill" to show proportions
  ylab("Proportion") +           # Label the y-axis
  xlab("Total score on the Social Phobia Inventory") +          # Label the x-axis
  labs(title = "Proportion of Reasons for Playing by SPIN Scores",
       fill = "Reasons for Playing") +  # Rename the legend title
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Center and bold the title
    axis.title.x = element_text(face = "bold", size = 12),  # Bold and size for x-axis label
    axis.title.y = element_text(face = "bold", size = 12),  # Bold and size for y-axis label
    axis.text.x = element_text(face = "bold", size = 10),   # Bold the x-axis tick labels
    axis.text.y = element_text(face = "bold", size = 10),   # Bold the y-axis tick labels
    legend.title = element_text(face = "bold"),             # Bold the legend title
    legend.text = element_text(face = "bold")               # Bold the legend labels
  )
  

```

explain


## Reccomednations 

Here we will state what we think should be done next (project part 2)

"We reccomedn running a logisitic regression blah blah blah" 





